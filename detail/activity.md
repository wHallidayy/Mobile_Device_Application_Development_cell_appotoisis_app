# Activity Diagram: ‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏†‡∏≤‡∏û‡πÄ‡∏ã‡∏•‡∏•‡πå‡∏î‡πâ‡∏ß‡∏¢ AI Model

## ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏Å‡∏£‡∏∞‡∏ö‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏†‡∏≤‡∏û

‡πÅ‡∏ú‡∏ô‡∏†‡∏≤‡∏û‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° (Activity Diagram) ‡∏ô‡∏µ‡πâ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏†‡∏≤‡∏û‡πÄ‡∏ã‡∏•‡∏•‡πå‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏†‡∏≤‡∏û‡∏à‡∏ô‡∏ñ‡∏∂‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå

```mermaid
flowchart TB
    subgraph Client["üñ•Ô∏è Client (Frontend)"]
        A([‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô]) --> B[‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå]
        B --> C[‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠ POST /api/v1/images/{id}/analyze]
    end

    subgraph Backend["‚öôÔ∏è Rust Backend Server"]
        C --> D{‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ}
        D -->|‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô| E[‡∏™‡πà‡∏á‡∏Å‡∏•‡∏±‡∏ö 401 Unauthorized]
        E --> Z1([‡∏à‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô])
        
        D -->|‡∏ú‡πà‡∏≤‡∏ô| F{‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏†‡∏≤‡∏û}
        F -->|‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏†‡∏≤‡∏û| G[‡∏™‡πà‡∏á‡∏Å‡∏•‡∏±‡∏ö 404 Not Found]
        G --> Z1
        
        F -->|‡∏ú‡πà‡∏≤‡∏ô| H[‡∏™‡∏£‡πâ‡∏≤‡∏á Job ‡πÉ‡∏ô Database\n‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: pending]
        H --> I[‡∏™‡∏£‡πâ‡∏≤‡∏á AnalysisJobMessage]
        I --> J[Publish Message ‡πÑ‡∏õ‡∏¢‡∏±‡∏á RabbitMQ]
        
        J -->|‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß| K[‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï Job ‡πÄ‡∏õ‡πá‡∏ô failed]
        K --> L[‡∏™‡πà‡∏á‡∏Å‡∏•‡∏±‡∏ö 500 Queue Error]
        L --> Z1
        
        J -->|‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à| M[‡∏™‡πà‡∏á‡∏Å‡∏•‡∏±‡∏ö 202 Accepted\n‡∏û‡∏£‡πâ‡∏≠‡∏° job_id ‡πÅ‡∏•‡∏∞ status_url]
    end

    subgraph RabbitMQ["üì® RabbitMQ Message Queue"]
        M --> N[Message ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ñ‡∏¥‡∏ß analysis_jobs]
        N --> O[‡∏£‡∏≠ Model Worker ‡∏£‡∏±‡∏ö Message]
    end

    subgraph ModelWorker["ü§ñ Python Model Worker"]
        O --> P[‡∏£‡∏±‡∏ö Message ‡∏à‡∏≤‡∏Å‡∏Ñ‡∏¥‡∏ß]
        P --> Q[Parse JSON Message\n‡∏î‡∏∂‡∏á job_id, s3_key]
        Q --> R[‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï Job ‡πÄ‡∏õ‡πá‡∏ô processing\n‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤]
        
        R --> S[‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏†‡∏≤‡∏û‡∏à‡∏≤‡∏Å MinIO\n‡πÉ‡∏ä‡πâ s3_key]
        S -->|‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß| AA[‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å Error]
        
        S -->|‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à| T[‡πÇ‡∏´‡∏•‡∏î‡∏†‡∏≤‡∏û‡πÄ‡∏õ‡πá‡∏ô PIL Image]
        T --> U[‡∏™‡πà‡∏á‡∏†‡∏≤‡∏û‡πÄ‡∏Ç‡πâ‡∏≤ YOLO Model\n‡∏ó‡∏≥ Inference]
    end

    subgraph Inference["üî¨ YOLO Inference Process"]
        U --> V[‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏†‡∏≤‡∏û‡∏î‡πâ‡∏ß‡∏¢ YOLO]
        V --> W[‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡πÄ‡∏ã‡∏•‡∏•‡πå‡πÅ‡∏•‡∏∞‡∏à‡∏≥‡πÅ‡∏ô‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó]
        W --> X[‡∏ô‡∏±‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏ã‡∏•‡∏•‡πå‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó\n- Normal/Viable\n- Apoptosis\n- Other]
        X --> Y[‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡πà‡∏≤ Confidence ‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢]
        Y --> Y2[‡∏™‡∏£‡πâ‡∏≤‡∏á Bounding Boxes Data]
        Y2 --> Y3[‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢]
    end

    subgraph SaveResult["üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå"]
        Y3 --> AB[‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å analysis_results\n‡∏•‡∏á PostgreSQL]
        AB --> AC[‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï Job ‡πÄ‡∏õ‡πá‡∏ô completed\n‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å finished_at]
        AC --> AD[ACK Message ‡πÉ‡∏ô RabbitMQ]
        
        AA --> AE[‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï Job ‡πÄ‡∏õ‡πá‡∏ô failed\n‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å error_message]
        AE --> AF[NACK Message ‡πÉ‡∏ô RabbitMQ]
    end

    subgraph Polling["üîÑ Client Polling"]
        AD --> AG[Client ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å GET /api/v1/jobs/{job_id}]
        AF --> AG
        AG --> AH{‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ Job}
        AH -->|pending/processing| AI[‡∏£‡∏≠‡πÅ‡∏•‡πâ‡∏ß Poll ‡πÉ‡∏´‡∏°‡πà]
        AI --> AG
        AH -->|failed| AJ[‡πÅ‡∏™‡∏î‡∏á Error Message]
        AJ --> Z2([‡∏à‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô])
        AH -->|completed| AK[‡πÄ‡∏£‡∏µ‡∏¢‡∏Å GET /api/v1/jobs/{job_id}/result]
    end

    subgraph DisplayResult["üìä ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå"]
        AK --> AL[‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå]
        AL --> AM[‡πÅ‡∏™‡∏î‡∏á‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏ã‡∏•‡∏•‡πå‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó]
        AM --> AN[‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå‡πÅ‡∏•‡∏∞ Confidence]
        AN --> AO[‡πÅ‡∏™‡∏î‡∏á Bounding Boxes ‡∏ö‡∏ô‡∏†‡∏≤‡∏û]
        AO --> AP[‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå]
        AP --> Z3([‡∏à‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô])
    end
```

---

## Activity Diagram: ‡∏Å‡∏£‡∏∞‡∏ö‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á Model Worker

```mermaid
flowchart TB
    subgraph Startup["üöÄ Model Worker Startup"]
        A([‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô Worker]) --> B[‡πÇ‡∏´‡∏•‡∏î Configuration]
        B --> C[‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ RabbitMQ\n‡∏î‡πâ‡∏ß‡∏¢ Retry Logic]
        C -->|‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß 30 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á| D([Worker ‡∏´‡∏¢‡∏∏‡∏î‡∏ó‡∏≥‡∏á‡∏≤‡∏ô])
        C -->|‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à| E[Declare Queue: analysis_jobs]
        E --> F[‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ QoS prefetch=1]
        F --> G[‡πÄ‡∏£‡∏¥‡πà‡∏° Consuming Messages]
    end

    subgraph Processing["‚öôÔ∏è Message Processing Loop"]
        G --> H{‡∏°‡∏µ Message ‡πÉ‡∏´‡∏°‡πà?}
        H -->|‡πÑ‡∏°‡πà‡∏°‡∏µ| H
        H -->|‡∏°‡∏µ| I[‡∏£‡∏±‡∏ö Message]
        I --> J[Parse JSON Body]
        J --> K[‡∏î‡∏∂‡∏á job_id ‡πÅ‡∏•‡∏∞ s3_key]
        K --> L[‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï DB: status=processing]
        L --> M[‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏†‡∏≤‡∏û‡∏à‡∏≤‡∏Å MinIO]
        M --> N[‡πÄ‡∏£‡∏µ‡∏¢‡∏Å run_inference]
        N --> O[‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏•‡∏á DB]
        O --> P[ACK Message]
        P --> H
    end

    subgraph ErrorHandling["‚ùå Error Handling"]
        J -->|Error| Q[Log Error]
        M -->|Error| Q
        N -->|Error| Q
        O -->|Error| Q
        Q --> R{‡∏°‡∏µ job_id?}
        R -->|‡∏°‡∏µ| S[‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï DB: status=failed]
        S --> T[NACK Message]
        R -->|‡πÑ‡∏°‡πà‡∏°‡∏µ| T
        T --> H
    end
```

---

## Activity Diagram: YOLO Inference Process

```mermaid
flowchart TB
    subgraph Input["üì• Input"]
        A([‡∏£‡∏±‡∏ö Image Bytes]) --> B[‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô PIL Image]
    end

    subgraph Model["üß† YOLO Model"]
        B --> C[‡∏™‡πà‡∏á‡∏†‡∏≤‡∏û‡πÄ‡∏Ç‡πâ‡∏≤ YOLO Model]
        C --> D[Model ‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏†‡∏≤‡∏û]
        D --> E[‡πÑ‡∏î‡πâ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå Detection Results]
    end

    subgraph Parse["üìä Parse Results"]
        E --> F[‡∏ß‡∏ô‡∏•‡∏π‡∏õ‡∏ó‡∏∏‡∏Å Bounding Box]
        F --> G[‡∏î‡∏∂‡∏á class_id ‡πÅ‡∏•‡∏∞ confidence]
        G --> H{class_id?}
        H -->|0| I1[apoptosis]
        H -->|1| I2[normal ‚Üí viable]
        H -->|2 ‡∏´‡∏£‡∏∑‡∏≠‡∏≠‡∏∑‡πà‡∏ô‡πÜ| I3[other]
        I1 --> J[‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ô‡∏±‡∏ö]
        I2 --> J
        I3 --> J
        J --> K[‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å Bounding Box Coordinates]
        K --> L[‡∏£‡∏ß‡∏° Confidence Score]
        L --> M{‡∏°‡∏µ Box ‡∏≠‡∏µ‡∏Å?}
        M -->|‡∏°‡∏µ| F
        M -->|‡πÑ‡∏°‡πà‡∏°‡∏µ| N[‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ Confidence]
    end

    subgraph Output["üì§ Output"]
        N --> O[‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó]
        O --> P[‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢]
        P --> Q([‡∏™‡πà‡∏á‡∏Å‡∏•‡∏±‡∏ö Result Dict])
    end
```

---

## ‡∏™‡∏£‡∏∏‡∏õ‡∏™‡πà‡∏ß‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏´‡∏•‡∏±‡∏Å

| Component | ‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ | ‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏´‡∏•‡∏±‡∏Å |
|-----------|----------|------------|
| **Backend Server** | Rust + Actix-web | ‡∏£‡∏±‡∏ö API Request, ‡∏™‡∏£‡πâ‡∏≤‡∏á Job, Publish Message |
| **Message Queue** | RabbitMQ | ‡∏à‡∏±‡∏î‡∏Ñ‡∏¥‡∏ß‡∏á‡∏≤‡∏ô‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÅ‡∏ö‡∏ö Async |
| **Model Worker** | Python + YOLO | ‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏†‡∏≤‡∏û‡∏î‡πâ‡∏ß‡∏¢ Deep Learning |
| **Object Storage** | MinIO (S3) | ‡πÄ‡∏Å‡πá‡∏ö‡∏†‡∏≤‡∏û‡∏ï‡πâ‡∏ô‡∏â‡∏ö‡∏±‡∏ö |
| **Database** | PostgreSQL | ‡∏à‡∏±‡∏î‡πÄ‡∏Å‡πá‡∏ö Job Status ‡πÅ‡∏•‡∏∞‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå |
